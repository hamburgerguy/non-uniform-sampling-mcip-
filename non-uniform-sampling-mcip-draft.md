* Feature Name: `Non-Uniform Ring Signature Sampling`
* Start Date: TBD
* MCIP PR:
  [mcips #?](https://github.com/mobilecoinfoundation/mcips/)
* Tracking Issue:
  [mobilecoin #?](https://github.com/mobilecoinfoundation/mobilecoin/issues/)


## Contents
- [Summary](#summary)
- [Motivation](#motivation)
- [Guide-level explanation](#guide-level-explanation)
- [Reference-level explanation](#reference-level-explanation)
  - [Uniform Sampling](#uniform-sampling)
    - [Security Risks](#security-risks)
  - [Non-Uniform Sampling](#non-uniform-sampling)
    - [Methods](#methods)
- [Drawbacks](#drawbacks)
- [Rationale and alternatives](#rationale-and-alternatives)
- [Prior art](#prior-art)
- [Unresolved questions](#unresolved-questions)
- [Future possibilities](#future-possibilities)

# Summary
[summary]: #summary

Current sampling of ring signatures to create aggregated signatures in MobileCoin uses a uniform sampling distribution. 

This unintentionally creates a bias towards younger signatures being the most likely candidate for the genuine signature and skews the selection bias which presents a potential de-anonymization security risk amongst other potential loopholes that could be possibly exploited. It should be noted that given a secure enclave setup, the security risk is negated. It should be noted that this vulnerability is for fog users that aren't using a secure enclave setup. A potential attacker could store multiple aggregate ring signatures in a database somewhere and given the selection bias be able to determine which signatures are genuine and which are decoys.  


# Motivation
[motivation]: #motivation

The problem as applied to the MobileCoin infrastructure seems multifaceted in that it requires an assessment of the current state of the MobileCoin mechanics in contrast to other blockchains that implement ring signatures such as Monero. At this stage of the MobileCoin development cycle it is worth at least creating a table and doing some research into possible solutions. 

The motivation behind this project is born out of the presently real and potential security concerns that using uniform sampling currently presents. It is not a security risk that completely breaks the anonymity generated by the system itself but it can be used as a potential attack vector and clearly creates a greater potential for tracing transactions and de-anonymization. This small leak in the proverbial cryptographic hull should be plugged before it has the potential to create larger problems that flood the security of other systems.  


# Guide-level explanation
[guide-level-explanation]: #guide-level-explanation

The Monero community recognized this problem and came up with their own solution to the security problem presented by uniform sampling. 

Conversations were made in the Monero community about possible ways to fix this problem and were discussed, the current implementation of the official Monero GUI uses an algorithm for sampling mixins that is non-uniform. Their solution implemented a log-gamma distribution with shape parameter 19.28 and scale 1/1.6 rather than a uniform sampling distribution for the official Monero GUI wallet. 

Other distributions of other wallets use other methods such as monero-lws. These algorithms seem to effectively solve the problem presented by using uniform sampling distributions of mixins. Given the probabilistic nature of this problem it is perhaps impossible to completely erase the possibility of tracing through mixin metadata but it can at the very least become a far more difficult task with negligible possibility of success.

One of the largest differences between the Monero mixin sampling solution and what MobileCoin could alternatively use is that the Monero solution that was utilized relied upon pre-RingCT data that was available. Using this available data they were able to come up with the fine tuned log-gamma distribution sampling solution that they employed that all but erased the problem for the most part. 

MobileCoin does not have pre-RingCT data available and so such a fine tuned solution would probably be outside the scope of possibility as no potential data curve is available to fit to. Despite this fact, some form of non-uniform sampling would be better than sticking with the current uniform sampling method currently employed. 

Finding which method of non-uniform sampling to choose from has its own difficulties. 

# Reference-level explanation
[reference-level-explanation]: #reference-level-explanation

There will be two classifications of non-uniform sampling mechanisms that could be potentially utilized:
1. Additive non-uniform sampling
2. Stochastic jitting non-uniform sampling

'''
more to be added here
'''

# Uniform Sampling 
[Uniform Sampling]: (#uniform-sampling)
In this framework we sample keys uniformly at random

# Security Risks 
[Security Risks]: (#security-risks)
By uniformly sampling keys at random to put into an aggregate ring signature, security risks can present themselves. The larger the possible sample of signatures there is if there is a uniform sampling distribution the more likely there is for the non-dummy (actual) signature that signed the transaction to be the earliest signature. This allows the anonymity afforded by the RingCT mechanism to be circumvented by easily recognizing from the publically available on chain-data that the earliest signature is the legitimate one. 



# Non-uniform sampling 
[Non-Uniform Sampling]: (#non-uniform-sampling)
In this framework we employ a to-be-determined method for sampling keys non-uniformly at random

# Methods 
[Methods]: (#methods)
### Additive Non-uniform Sampling
Explanation of additive sampling

Pros:
* 

Cons:
* 


#### Stochastic jitting Non-uniform sampling
Explanation of stochastic jitting non-uniform sampling

Pros:
* 

Cons:
* 

## Implementation details and project difficulty
After possible solutions have been researched, the most likely replacement for the current implementation will be considered in terms of difficulty of implementation in terms of replacing the current uniform sampling mechanism. Project difficulty, possible methods, libraries to be used, timelines for production etc. 

Nonuniform sampling is based on Lagrange interpolation and the relationship between itself and the (uniform) sampling theorem. The Nyquist-Shannon sampling theorem can be applied as well to find the exact function needed to generate a truly random set of sample keys.  




# Drawbacks
[drawbacks]: #drawbacks

The primary drawback to this project is merely time and project difficulty required to implement it. From a technical perspective there is little to no drawback unless retroactively it turns out that whatever non-uniform sampling method that has been employed to replace the current mechanism turns out to present a new security risk. This seems unlikely and so the only real drawback likely would be if it turns out the problem is not solved by implementing a new mechanism, but since this problem already exists in the current framework this could be considered to not be considerably problematic. Considerably, there is null drawback besides time constraints to implement.

# Rationale and alternatives
[rationale-and-alternatives]: #rationale-and-alternatives
This seems like a rational action to implement and project to execute as there is null drawback and certain positive gain. Essentially, this project has to be implemented at some point in the future to maintain the security features. 

Alternatively if it's decided its better to focus attention elsewhere, since this does not present any absolutely endgame breaking immediate security risk this could be a potential alternative course of action.  


# Prior art
[prior-art]: #prior-art

* Monero docs on log-gamma soln: 


# Unresolved questions
[unresolved-questions]: #unresolved-questions

We don't know how we are going to implement a successful RingCT non-uniform sampling distribution as fine tuned as the one used for Monero without de-anonymized pre-RingCT data. 

# Future possibilities
[future-possibilities]: #future-possibilities

While this MCIP focuses on non-uniform sampling, potential discoveries from doing research into this avenue could turn out to be useful elsewhere in other projects. 

